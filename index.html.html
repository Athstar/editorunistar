<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Story Editor - Export Only</title>
<style>
body { font-family: Arial; margin: 20px; background: #f0f2f5; }
h1 { text-align: center; }
#toolbar {
  margin-bottom:10px; padding:5px; background:#fff; border:1px solid #ccc; border-radius:8px;
  display:flex; flex-wrap:wrap; gap:5px; overflow-x:auto; align-items:center;
}
#toolbar button { border:none; background:#e0e0e0; padding:8px 12px; cursor:pointer; border-radius:5px; font-weight:bold; transition:0.2s; }
#toolbar button:hover { background:#c0c0c0; }
#toolbar input[type=color], #toolbar select { padding:5px; border-radius:5px; border:1px solid #ccc; cursor:pointer; height:32px; }
#toolbar label { margin-left:5px; margin-right:2px; font-weight:normal; }
#editor {
  width:100%; max-width:700px; min-height:400px; border:1px solid #ccc; border-radius:8px; padding:10px; background:#fff; overflow-y:auto; color:#000;
}
#editor:empty:before { content: attr(data-placeholder); color:#aaa; pointer-events:none; }
@media(max-width:600px){
  #toolbar button,#toolbar select,#toolbar input[type=color]{padding:6px 8px;font-size:14px;}
  #editor{min-height:200px;font-size:14px;}
}
</style>
</head>
<body>

<h1>Story Editor - Export Only</h1>

<!-- Toolbar -->
<div id="toolbar">
  <button onclick="formatText('bold')"><b>B</b></button>
  <button onclick="formatText('italic')"><i>I</i></button>
  <button onclick="formatText('underline')"><u>U</u></button>

  <button onclick="formatText('insertOrderedList')">OL</button>
  <button onclick="formatText('insertUnorderedList')">UL</button>

  <label>Text Color:</label>
  <input type="color" onchange="formatText('foreColor',this.value)">
  <label>Highlight:</label>
  <input type="color" onchange="formatText('backColor',this.value)">

  <label>Font Size:</label>
  <select onchange="formatText('fontSize',this.value)">
    <option value="1">8px</option>
    <option value="2">10px</option>
    <option value="3" selected>12px</option>
    <option value="4">14px</option>
    <option value="5">18px</option>
    <option value="6">24px</option>
    <option value="7">36px</option>
  </select>

  <button onclick="insertImage()">Image</button>
  <button onclick="insertLink()">Link</button>

  <button onclick="formatText('undo')">Undo</button>
  <button onclick="formatText('redo')">Redo</button>
  <button onclick="formatText('removeFormat')">Clear</button>
</div>

<!-- Editor -->
<div id="editor" contenteditable="true" data-placeholder="Start writing your story here..."></div>
<br>

<!-- Export Section -->
<label>Export as:</label>
<select id="exportFormat">
  <option value="pdf">PDF</option>
  <option value="docx">Word (DOCX)</option>
  <option value="txt">Plain Text</option>
</select>
<button onclick="exportStory()">Export</button>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>

<script>
  // Toolbar functions
  function formatText(command,value=null){ document.execCommand(command,false,value); }
  function insertImage(){ let url=prompt("Enter image URL:"); if(url) formatText('insertImage',url); }
  function insertLink(){ let url=prompt("Enter link URL:"); if(url) formatText('createLink',url); }

  // Export function
  async function exportStory(){
    const format = document.getElementById('exportFormat').value;
    const editor = document.getElementById('editor');
    const title = prompt("Enter file name:", "MyStory");
    if(!title) return;

    if(format === "txt"){
      const blob = new Blob([editor.innerText], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = title + ".txt";
      link.click();
    }
    else if(format === "pdf"){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const lines = editor.innerText.split("\n");
      let y = 10;
      lines.forEach(line => { doc.text(line, 10, y); y+=10; });
      doc.save(title + ".pdf");
    }
    else if(format === "docx"){
      const { Document, Packer, Paragraph, TextRun } = window.docx;
      const doc = new Document({
        sections: [{
          children: [new Paragraph({ children: [new TextRun(editor.innerText)] })]
        }]
      });
      const packer = new Packer();
      const blob = await packer.toBlob(doc);
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = title + ".docx";
      link.click();
    }
  }
</script>

</body>
</html>
